@{
  ViewData["Title"] = "Crane Booking Form";
  Layout = "_ContentNavbarLayout";
}

@section PageStyles {
  <style>
    .shift-table {
      width: 100%;
      border-collapse: collapse;
    }

    .shift-table th,
    .shift-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    .shift-table th {
      background-color: #f2f2f2;
    }

    .shift-checkbox {
      width: 20px;
      height: 20px;
    }

    .required-label:after {
      content: " *";
      color: red;
    }

    .hazard-checkbox {
      margin-right: 5px;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section-title {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #ddd;
    }

    .custom-hazard {
      margin-top: 1rem;
    }
  </style>
}

<div class="row">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Crane Booking Form</h5>
        <small class="text-muted float-end">All fields marked with * are required</small>
      </div>
      <div class="card-body">
        <form id="craneBookingForm">

          <!-- Requestor Information Section -->
          <div class="form-section">
            <h6 class="form-section-title">Requestor Information</h6>
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Requestor Name</label>
                <input id="name" name="name" class="form-control" required />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Department Name</label>
                <input id="department" name="department" class="form-control" required />
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Supervisor Name</label>
                <input id="projectSupervisor" name="projectSupervisor" class="form-control" required />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Phone Number</label>
                <input id="phoneNumber" name="phoneNumber" class="form-control" placeholder="e.g. 123-456-7890"
                  required />
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Cost Code</label>
                <input id="costCode" name="costCode" class="form-control" required />
              </div>
            </div>
          </div>

          <!-- Booking Details Section -->
          <div class="form-section">
            <h6 class="form-section-title">Booking Details</h6>
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="startDate" class="form-label required-label">Start Date</label>
                <input type="date" id="startDate" name="startDate" class="form-control" required />
                <span class="text-danger" id="startDateError"></span>
              </div>
              <div class="col-md-6 mb-3">
                <label for="endDate" class="form-label required-label">End Date</label>
                <input type="date" id="endDate" name="endDate" class="form-control" required />
                <span class="text-danger" id="endDateError"></span>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label required-label">Crane</label>
                <select id="craneId" name="craneId" class="form-select" required>
                  <option value="">Select a Crane</option>
                  <!-- Crane options will be loaded dynamically -->
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label required-label">Location</label>
                <input id="location" name="location" class="form-control" required />
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <div id="shiftTableContainer" class="mt-3" style="display: none;">
                  <!-- Shift table will be generated here -->
                </div>
                <span class="text-danger" id="shiftTableError"></span>
              </div>
            </div>
          </div>

          <!-- Job Details Section -->
          <div class="form-section">
            <h6 class="form-section-title">Job Details</h6>
            <div class="row mb-3">
              <div class="col-12 mb-3">
                <label class="form-label required-label">Job Description</label>
                <textarea id="description" name="description" class="form-control" rows="3" required></textarea>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label required-label">Items to be Lifted</label>
                <div class="table-responsive">
                  <table class="table table-bordered" id="liftedItemsTable">
                    <thead>
                      <tr>
                        <th>Item Name</th>
                        <th>Height (m)</th>
                        <th>Weight (ton)</th>
                        <th>Quantity</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="liftedItemsBody">
                      <!-- The rows will be added by JavaScript on page load -->
                    </tbody>
                  </table>
                  <button type="button" id="addItemBtn" class="btn btn-outline-primary btn-sm">
                    <i class="bx bx-plus"></i> Add Another Item
                  </button>
                </div>
                <span class="text-danger" id="liftedItemsError"></span>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label required-label">Potential Hazards</label>
                <div id="hazardsContainer" class="row">
                  <!-- Hazards will be loaded dynamically -->
                </div>
                <div class="custom-hazard">
                  <label class="form-label">Custom Hazard (Optional)</label>
                  <input id="customHazard" name="customHazard" class="form-control"
                    placeholder="Specify any other hazards not listed above" />
                </div>
                <span class="text-danger" id="hazardsError"></span>
              </div>
            </div>
          </div>

          <!-- Terms and Submission Section -->
          <div class="form-section">
            <div class="row mb-3">
              <div class="col-12">
                <div class="form-check">
                  <input id="termsAgreement" class="form-check-input" type="checkbox" required />
                  <label class="form-check-label required-label">
                    I agree to the terms and conditions
                  </label>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 d-flex justify-content-between">
                <a href="/Calendar" class="btn btn-secondary">Cancel</a>
                <button type="button" id="submitButton" class="btn btn-primary">Submit Booking</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Success modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="successModalLabel">Booking Successful</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Your crane booking has been submitted successfully!
      </div>
      <div class="modal-footer">
        <a href="/Calendar/Index" class="btn btn-primary">Go to Calendar</a>
      </div>
    </div>
  </div>
</div>

<!-- Error modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="errorModalLabel">Booking Error</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="errorModalBody">
        An error occurred while submitting your booking.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

@section PageScripts {
  <script src="~/js/booking-form/booking-form.js"></script>
}
