@{
  ViewData["Title"] = "Crane Booking Form";
  Layout = "_ContentNavbarLayout";
}

@section PageStyles {
  <style>
    .required-label:after {
      content: " *";
      color: red;
    }

    .hazard-checkbox {
      margin-right: 5px;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section-title {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #ddd;
    }

    .custom-hazard {
      margin-top: 1rem;
    }
  </style>
}

<div class="row">
  <div class="col-12">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Crane Booking Form</h5>
        <small class="text-muted float-end">All fields marked with * are required</small>
      </div>
      <div class="card-body">
        <form id="craneBookingForm">

          <!-- Hidden fields for user data -->
          <input type="hidden" id="userName" value="@ViewData["UserName"]" />
          <input type="hidden" id="userDepartment" value="@ViewData["UserDepartment"]" />

          <!-- Requestor Information Section -->
          <div class="form-section">
            <h6 class="form-section-title">Requestor Information</h6>
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Requestor Name</label>
                <input id="name" name="name" class="form-control" required readonly />
                <small class="text-muted">Automatically filled based on your login information</small>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Department Name</label>
                <input id="department" name="department" class="form-control" required readonly />
                <small class="text-muted">Automatically filled based on your login information</small>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Supervisor Name</label>
                <input id="projectSupervisor" name="projectSupervisor" class="form-control" required />
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Phone Number</label>
                <input id="phoneNumber" name="phoneNumber" class="form-control" placeholder="e.g. 123-456-7890"
                  required />
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label class="form-label required-label">Cost Code</label>
                <input id="costCode" name="costCode" class="form-control" required />
              </div>
            </div>
          </div>

          <!-- Booking Details Section -->
          <div class="form-section">
            <h6 class="form-section-title">Booking Details</h6>
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="startDate" class="form-label required-label">Start Date</label>
                <input type="date" id="startDate" name="startDate" class="form-control" required />
                <span class="text-danger" id="startDateError"></span>
              </div>
              <div class="col-md-6 mb-3">
                <label for="endDate" class="form-label required-label">End Date</label>
                <input type="date" id="endDate" name="endDate" class="form-control" required />
                <span class="text-danger" id="endDateError"></span>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label required-label">Crane</label>
                <select id="craneId" name="craneId" class="form-select" required>
                  <option value="">Select a Crane</option>
                  <!-- Crane options will be loaded dynamically -->
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label required-label">Location</label>
                <input id="location" name="location" class="form-control" required />
              </div>
            </div>

            <!-- Shift Selection Table - Using newer template -->
            <div class="row mb-3">
              <div class="col-12">
                <div id="shiftTableContainer" class="mt-3 card" style="display: none;">
                  <h5 class="card-header">Shift Selection</h5>
                  <div class="table-responsive text-nowrap">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <!-- Shift columns will be added dynamically -->
                        </tr>
                      </thead>
                      <tbody class="table-border-bottom-0" id="shiftTableBody">
                        <!-- Shift rows will be added dynamically -->
                      </tbody>
                    </table>
                  </div>
                </div>
                <span class="text-danger" id="shiftTableError"></span>
              </div>
            </div>
          </div>

          <!-- Job Details Section -->
          <div class="form-section">
            <h6 class="form-section-title">Job Details</h6>
            <div class="row mb-3">
              <div class="col-12 mb-3">
                <label class="form-label required-label">Job Description</label>
                <textarea id="description" name="description" class="form-control" rows="3" required></textarea>
              </div>
            </div>

            <!-- Items to be Lifted Table - Using newer template -->
            <!-- Items to be Lifted Table - Using Shift Selection template -->
            @* <div class="row mb-3">
              <div class="col-12">
                <div id="itemsTableContainer" class="mt-3 card">
                  <h5 class="card-header">Items to be Lifted</h5>
                  <div class="table-responsive text-nowrap">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th style="width: 40%;">Item Name</th>
                          <th style="width: 15%;">Height (m)</th>
                          <th style="width: 15%;">Weight (ton)</th>
                          <th style="width: 15%;">Quantity</th>
                          <th style="width: 15%;"></th>
                        </tr>
                      </thead>
                      <tbody class="table-border-bottom-0" id="liftedItemsBody">
                        <!-- The rows will be added by JavaScript on page load -->
                      </tbody>
                    </table>
                  </div>
                  <div class="card-footer">
                    <button type="button" id="addItemBtn" class="btn btn-outline-primary btn-sm">
                      <i class="bx bx-plus"></i> Add Another Item
                    </button>
                  </div>
                </div>
                <span class="text-danger" id="liftedItemsError"></span>
              </div>
            </div> *@
            <!-- Items to be Lifted Table - Using Shift Selection template -->
            <!-- Items to be Lifted Table - Using Shift Selection template -->
            <div class="row mb-3">
              <div class="col-12">
                <div id="itemsTableContainer" class="mt-3 card">
                  <h5 class="card-header">Items to be Lifted</h5>
                  <div class="table-responsive text-nowrap">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th style="width: 40%; min-width: 250px;">Item Name</th>
                          <th style="width: 15%; min-width: 130px;">Height (m)</th>
                          <th style="width: 15%; min-width: 130px;">Weight (ton)</th>
                          <th style="width: 15%; min-width: 130px;">Quantity</th>
                          <th style="width: 15%; min-width: 60px;"></th>
                        </tr>
                      </thead>
                      <tbody class="table-border-bottom-0" id="liftedItemsBody">
                        <!-- The rows will be added by JavaScript on page load -->
                      </tbody>
                    </table>
                  </div>
                  <div class="card-footer">
                    <button type="button" id="addItemBtn" class="btn btn-outline-primary btn-sm">
                      <i class="bx bx-plus"></i> Add Another Item
                    </button>
                  </div>
                </div>
                <span class="text-danger" id="liftedItemsError"></span>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-12">
                <label class="form-label required-label">Potential Hazards</label>
                <div id="hazardsContainer" class="row">
                  <!-- Hazards will be loaded dynamically -->
                </div>
                <div class="custom-hazard">
                  <label class="form-label">Custom Hazard (Optional)</label>
                  <input id="customHazard" name="customHazard" class="form-control"
                    placeholder="Specify any other hazards not listed above" />
                </div>
                <span class="text-danger" id="hazardsError"></span>
              </div>
            </div>
          </div>

          <!-- Terms and Submission Section -->
          <div class="form-section">
            <div class="row mb-3">
              <div class="col-12">
                <div class="form-check">
                  <input id="termsAgreement1" class="form-check-input" type="checkbox" required />
                  <label class="form-check-label required-label" for="termsAgreement1">
                    Pengguna harus menyiapkan akses yang aman ke area kerja dan tempat kerja yang aman. Untuk bekerja
                    pada malam hari, pengguna harus menyediakan penerangan yang cukup memadahi.
                  </label>
                </div>
                <div class="form-check">
                  <input id="termsAgreement2" class="form-check-input" type="checkbox" required />
                  <label class="form-check-label required-label" for="termsAgreement2">
                    Penguna harus melengkapi izin yang sudah disetujui. Misalnya izin bekerja di dekat saluran listrik,
                    Akses PIT dll dan pengguna harus memandu bila diperlukan untuk ke lokasi pekerjaan dan
                    membantu mengawasi pekerjaan yang sedang berlangsung dan juga pengguna harus menginformasikan secara
                    tertulis jika ada perubahan akses atau jalur yang akan dilalui.
                  </label>
                </div>
                <div class="form-check">
                  <input id="termsAgreement3" class="form-check-input" type="checkbox" required />
                  <label class="form-check-label required-label" for="termsAgreement3">
                    Hanya pekerjaan yang sesuai denga persyaratan yang akan diproses.
                  </label>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-12 d-flex justify-content-between">
                <a href="/Calendar" class="btn btn-secondary">Cancel</a>
                <button type="button" id="submitButton" class="btn btn-primary">Submit Booking</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Success modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="successModalLabel">Booking Successful</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Your crane booking has been submitted successfully!
      </div>
      <div class="modal-footer">
        <a href="/Calendar/Index" class="btn btn-primary">Go to Calendar</a>
      </div>
    </div>
  </div>
</div>

<!-- Error modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="errorModalLabel">Booking Error</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="errorModalBody">
        An error occurred while submitting your booking.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

@section PageScripts {
  <script src="~/js/booking-form/booking-form.js"></script>
}
